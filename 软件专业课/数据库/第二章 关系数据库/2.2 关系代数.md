[toc]

## 关系代数概述

- 关系代数是一种抽象的查询语言，用 **对关系的运算** 来表达查询。

- 运算
	- 运算对象：关系
	- 运算结果：关系
	- 运算符
		- 集合运算符
		- 专门的关系运算符
		- 比较运算符
		- 逻辑运算符

### 集合运算符

|运算符|含义|
|-|-|
|∪|并|
|－|减|
|∩|交|
|×|广义笛卡儿积|

### 专门的关系运算符

|运算符|含义|
|-|-|
|σ|选择|
|Π|投影|
|⋈|连接|
|÷|除|

### 比较运算符

|运算符|含义|
|-|-|
|&gt;|大于|
|≥|大于等于|
|&lt;|小于|
|≤|小于等于|
|=|等于|
|≠|不等于|

### 逻辑运算符

|运算符|含义|
|-|-|
|¬|非|
|∧|与|
|∨|或|

## 传统的代数运算

### 并

**R &cup; S = {t | t &isin; R &or; t &isin; S}**

- 特征：参加运算的两个关系 要具有 **相同的目**。
- 作用：在一个关系中插入一个数据集合（关系），自动 **去掉相同元组**。

> 例：

> R：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|

> S：
>
|A|B|C|
|-|-|-|
|4|5|6|
|7|8|9|

> R ∪ S：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|
|7|8|9|

### 差

**R - S = {t | t &isin; R &and; t &notin; S}**

- 特征：参加运算的两个关系，要具有 **相同的目**。
- 作用：从某一关系中 **删除另一关系**。

> 例：

> R：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|

> S：
>
|A|B|C|
|-|-|-|
|4|5|6|
|7|8|9|

> R - S：
>
|A|B|C|
|-|-|-|
|1|2|3|

> S - R：
>
|A|B|C|
|-|-|-|
|7|8|9|

### 交

**R &cap; S = {t | t &isin; R &and; t &isin; S}**

- 特征：参加运算的两个关系，要具有 **相同的目**。
- 作用：从两个关系中 **取出相同的元组**。

> 例：

> R：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|

> S：
>
|A|B|C|
|-|-|-|
|4|5|6|
|7|8|9|

> R ∩ S：
>
|A|B|C|
|-|-|-|
|4|5|6|

### 广义笛卡儿积

**R × S = {t<sub>r</sub>t<sub>s</sub> | t<sub>r</sub> &isin; R &and; t<sub>s</sub> &isin; S}**

- **若 R 有 m 列，S 有 n 列，则 R × S 有 m + n 列**。
- **若 R 有 i 行，S 有 j 行，则 R × S 有 i * j 行**。

> 例：

> R：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|

> S：
>
|A|B|C|
|-|-|-|
|4|5|6|
|7|8|9|

> R × S：
>
|R.A|R.B|R.C|S.A|S.B|S.C|
|-|-|-|-|-|-|
|1|2|3|4|5|6|
|1|2|3|7|8|9|
|4|5|6|4|5|6|
|4|5|6|7|8|9|

## 专门的关系运算符

- 相关概念
	- 关系模式表示：
		- R(A<sub>1</sub>, A<sub>2</sub>, ..., A<sub>n</sub>)
	- 设 t 是 R 的一个元祖：
		- t [A<sub>i</sub>]：元祖 t 在属性 A<sub>i</sub> 上的 **分量值**。
		- t [A]：元祖 t 在 **属性列 A** 上的各个分量 **集合**。

### 选择

**&sigma;<sub>F</sub>(R) = {t | t &isin; R &and; F(t) = 'true'}**

- F：选择条件，用 **逻辑表达式** 表示。
- 选择操作实际是将关系 R 中部分元组重新构成一个新的关系 R。
- 当选择条件的等号 `=` 后面是字符或字符串时，将其用单引号 `''`。

> 例：

> R：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|

> ↓ σ<sub>B='5' ∧ C='6'</sub>(R)
> |A|B|C|
|-|-|-|
|4|5|6|

### 投影

**&Pi;<sub>A</sub>(R) = {t[A] | t &isin; R}**

- A 表示属性名，多个属性名用 **逗号** 隔开。
- 投影将关系 R 中若干属性列取出组成新的关系，并 **删除重复列**。
- 属性名可以用 **列序号** 表示。

> 例：

> R：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|

> ↓ Π<sub>B, C</sub>(R)
> |B|C|
|-|-|
|2|3|
|5|6|

### 连接

**R ⋈<sub>A&theta;B</sub> S = {t<sub>r</sub>t<sub>s</sub> | t<sub>r</sub> &isin; R &and; t<sub>s</sub> &isin; S &and; t<sub>r</sub>[A] &theta; t<sub>s</sub>[B]}**

- 连接是表示从两个关系的笛卡尔积中选择 **属性间满足一定条件** 的元组。
- A 和 B 为 R 和 S 上度数相等且 **可比** 的 **属性** 或 **属性组**。
- θ：表示 **比较运算符**，又称 **条件连接**。

> 例：

> R：
>
|A|B|C|
|-|-|-|
|1|2|3|
|4|5|6|

> S：
>
|A|B|C|
|-|-|-|
|4|5|6|
|7|8|9|

> ↓ R⋈<sub>R.C &lt; S.B</sub>S

> |R.A|R.B|R.C|S.A|S.B|S.C|
|-|-|-|-|-|-|
|1|2|3|4|5|6|
|1|2|3|7|8|9|
|4|5|6|7|8|9|

### 等值连接

**R ⋈<sub>A = B</sub> S = {t<sub>r</sub>t<sub>s</sub> | t<sub>r</sub> &isin; R &and; t<sub>s</sub> &isin; S &and; t<sub>r</sub>[A] = t<sub>s</sub>[B]}**

> 当结果为空关系时，用 **表头以及一行空行** 表示。
>
|R.A|R.B|S.A|C|
|-|-|-|-|
|&nbsp;|&nbsp;|&nbsp;|&nbsp;|

### 自然连接

**R ⋈ S = {t<sub>r</sub>t<sub>s</sub> | t<sub>r</sub> &isin; R &and; t<sub>s</sub> &isin; S &and; t<sub>r</sub>[A] = t<sub>s</sub>[A]}**

- 自然连接是从两个关系的广义笛卡儿积中选取在 **相同属性列 A** 上取值相等的元组，并 **去掉重复的列**。
- **当 R 与 S 无相同属性时，R ⋈ S ＝ R × S**。

### 外连接

- 如果把被舍弃的元组也保存到结果关系中，而在其他属性上填 **空值（NULL）**，那么这种连接称为 **外连接**。
- 如果只把 **左边** 关系 R 中要舍弃的元组保留，则称为 **左外连接**。
- 如果只把 **右边** 关系 S 中要舍弃的元组保留，则称为 **右外连接**。

## 关系代数练习题

学生关系表(Student)

|SNo（学号）|SName(姓名）|Sex（性别）|Language（外语语种）|ClsNo（所在班级）|
|-|-|-|-|-|
|20039001|张同|男|英语|0018|
|20039002|李飞|男|英语|0018|
|20039003|孙娟|女|英语|0019|
|20039004|宋生|男|英语|0019|
|20039005|张同|女|英语|0020|

学生选课关系表(Elective)

|CNo（课程编号）|SNo（学号）|Score（成绩）|Location（上课地点）|
|-|-|-|-|
|0002|20039001|57|9501|
|0005|20039001|78|9101|
|0003|20039002|67|9201|
|0004|20039003|84|9301|
|0001|20039004|93|9401|
|0002|20039005|77|9501|
|0005|20039005|91|9101|

问题：

1. 查询全体学生的姓名和学号
2. 查询 '0018' 班所有学生姓名
3. 查询 '0002' 号课程成绩为及格以上的学生学号
4. 查询选修了 '0002' 号课程的学生姓名
5. 查询未上过任何课程的学生学号
6. 查询至少选修了两门课程的学生学号


答案：

1. Π<sub>SNo, SName</sub>(Student)
2. Π<sub>SName</sub>(σ<sub>ClsNo = '0018'</sub>(Student))
3. Π<sub>SNo</sub>(σ<sub>CNo = '0002' ∧ Score ≥ 60</sub>(Elective))
4. Π<sub>SName</sub>(σ<sub>CNo = '0002'</sub>(Student ⋈ Elective))
5. Π<sub>SNo</sub>(Student) - Π<sub>SNo</sub>(Elective)
6. Π<sub>SNo</sub>(σ<sub>1 = 5 ∧ 2 ≠ 6</sub>(Elective × Elective))
