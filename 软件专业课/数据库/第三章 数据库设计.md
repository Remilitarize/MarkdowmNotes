[toc]

## 数据库设计概述

对于一个给定的应用环境，构造（设计）优化的数据库 **逻辑模式** 和 **物理结构**，并据此建立数据库及其应用系统，使之能够有效地存储数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求。

### 数据库设计的目标和方法

#### 数据库设计目标

- 最大限度地满足用户的应用功能需求。
- 获得良好的数据库性能。
- 对现实世界模拟的精确度要高。
- 数据库设计应充分利用和发挥现有DBMS的功能和性能。
- 符合软件工程设计要求，因为应用程序设计本身就是数据库设计任务的一部分。

#### 数据库设计方法

- 新奥尔良方法
	- 传统数据库设计方法中，在完成系统的需求分析后随即开始数据库的逻辑设计。
	- 而新奥尔良方法是在"逻辑设计"阶段的前面增加一个"概念设计"阶段。
- 基于 E-R 模型的数据库设计方法
	- 该方法是数据库概念设计阶段广泛采用的方法。
	- 它完成了将 **现实世界的客观事物及其联系** 转换为 **概念世界的实体与联系**。
- 3NF设计方法。
	- 该方法以关系数据库理论为指导来设计数据库的逻辑模型，该方法需要利用关系规范化理论对所设计的关系模式进行规范，一般要求将 **关系模式规范到 3NF 以上**。
- 对象定义语言（Object Definition Language，ODL）方法
	- 这是面向对象的数据库设计方法，该方法用 **面向对象的概念和术语来说明数据库结构**。
	- 用 ODL 描述面向对象数据库结构设计，可以将其直接转换为面向对象的数据库。

### 数据库设计的基本步骤

- **需求分析**
- **概念结构设计**
- **逻辑结构设计**
- **物理结构设计**
- **数据库实施**
- **数据库运行和维护**

## 需求分析

### 需求分析的任务

需求分析阶段任务是对系统的整个应用情况作全面的、详细的调查，确定企业组织的目标，收集支持系统总的设计目标的基础数据和对这些数据的要求，确定用户的需求，并把这些要求写成用户和数据库设计者都能够接受的文档。

需求分析中调查分析的方法很多，通常的办法是对不同层次的企业管理人员进行个人访问，内容包括业务处理和企业组织中的各种数据。访问的结果应该包括数据的流程、过程之间的接口以及访问者和职员两方面对流程和接口语义上的核对说明和结论。对于某些特殊的目标和数据库的要求，可以从企业组织中的最高层机构得到。

设计人员还应该了解系统将来要发生的变化，收集未来应用所涉及的数据，充分考虑到系统可能的扩充和变动，使系统设计更符合未来发展的趋向，并且易于改动，以减少系统维护的代价。

总体信息需求定义了未来系统用到的所有信息，描述了数据之间本质上和概念上的联系，描述了实体、属性、组合及联系的性质。

这一阶段的结果是 **"需求规格说明书"**，其主要内容是系统的 **数据流图** 和 **数据字典**。

### 需求分析的步骤

1. 分析用户活动，产生用户活动图。
2. 确定系统范围，产生系统范围图。
3. 分析用户活动所涉及的数据，产生数据流图。
4. 分析系统数据，产生数据字典。

**数据流图**（Data Flow Diagram，简记为 DFD）是"数据"和"对数据的加工"两方面表达数据处理系统工作过程的一种图形表示法。

- 数据流（用箭头表示）
- 加工或处理（用圆圈表示）
- 文件（用双线段表示）
- 外部实体（数据流的源点或终点，用方框表示）

![DFD 数据流图](http://oxnec2zdn.bkt.clouddn.com/DatabaseSQLServer/DFD.png)

- DFD 可作为自顶向下逐步细化时描述对象的工具。
- DFD 可以形象地表示数据流与各业务活动的关系。

**数据字典** 提供了对数据库数据描述的集中管理，它的功能是存储和检索各种数据描述（称为元数据 Metadata），如叙述性的数据定义等，并且为 DBA 提供有关的报告。

数据字典通常包括:

- 数据项
	- 数据项是数据的最小单位，对数据项的描述。
- 数据结构
	- 数据结构反映了数据之间的组合关系。
- 数据流
	- 表示某一加工处理过程的输入或输出数据。
- 数据存储
	- 数据存储是处理过程中要存储的数据，它可以是手工凭证、手工文档或计算机文档。
- 加工过程
	- 对加工处理的描述包括加工过程名、说明、输入数据流、输出数据流，并简要说明处理工作、频度要求、数据量及响应时间等。

### 软件需求规格说明书

软件的规格说明也称为功能规格说明、需求协议或系统规格说明，它精确地阐述了一个软件系统必须提供的功能、必须具备的性能以及需要考虑的限制条件。软件需求规格说明书不仅是系统测试和编写用户操作手册的基础，也是项目规划、设计和编码的基础，它应尽可能完整地描述系统预期的外部行为和用户可视化行为。

软件开发的需求规格说明书的结构与国际标准和国家标准相似，但有所不同，实际应用时可根据需要对照国际标准或国家标准进行修改，以调整形成适合自己所开发的软件需求规格说明书。

## 概念结构设计

### 概念结构设计任务和 E-R 模型的特点

数据库的概念结构设计是整个数据库设计的关键阶段，其主要任务是通过对用户需求进行综合、归纳与抽象，形成一个独立于具体DBMS的概念模式。

- 能真实、充分地反映现实世界。
- 易于理解。
- 易于更改。
- 易于向关系、网状、层次等各种数据模型转换。

### 概念结构设计的基本方法

- 自底向上的设计方法
	- 这种方法的基本点是将前面需求分析中收集到的数据元素作为基本输入，通过对这些元素的分析，先把它们综合成相应的实体或联系，进而构成局部概念模式。
- 自顶向下的设计方法
	- 从分析组织的事务活动开始，首先识别用户所关心的实体及实体间的联系，建立一个初步的数据模型框架，然后以逐步求精的方式加上必须的描述属性形成一个完整的局部 E-R 模型，最后将这些局部 E-R 模型集成为一个统一的全局 E-R 模型。
- 混合设计方法
	- 将自底向上和自顶向下的方法相结合，在实际项目开发中概念设计常用的方法是自顶向下地进行需求分析，然后再自底向上地设计概念结构。

### 概念结构设计的主要步骤

1. 进行数据抽象，设计局部概念模式。
2. 将局部概念模式综合成全局概念模式。
3. 评审

### 局部 E-R 模型的设计

1. 确定局部结构范围
	- 把那些关系最密切的若干功能所涉及到的数据尽可能地包含在一个局部 E-R 模型内。
 	- 一个局部 E-R 模型中所包含的实体数不能太多，以免过于复杂，不便理解和管理。
2. 确定实体及实体的主键
	- 确定实体
		- **实体** 是一个数据对象，指应用中可以区别的客观存在的事物。
		- 同一类实体构成 **实体集**。
	- 确定实体的主键
		- **主键是确定实体的唯一标志**。
3. 确定实体间的联系
	- **联系** 是实体集之间关系的抽象表示，即对现实世界中事物之间关系的描述。
	- **联系本身也可以有属性**，当一个属性不能归并到两个实体上时，就可以定义为联系的属性。
	- 在确定联系类型时，应注意防止出现 **冗余联系**（即可以从其他联系导出的联系）。
	- 实体间可能存在多个联系。
4. 给实体及联系加上描述属性    
	- 属性应该是不可再分解的语义单位。
	- 实体与属性之间的关系只能是 1:N 的。
	- 不同实体类型的属性之间应无直接关联关系。
5. E-R 模型的操作    
	- 分裂方式有 **水平分裂** 和 **垂直分裂** 两种。
		- 依据某个属性进行分裂属于 **水平分裂**，例将教师分裂为男教师和女教师、
		- 依据经常发生变化的某些属性进行分裂属于 **垂直分裂**，例教师的工资。奖金经常变化，则单独构成一个实体。
	- 联系类型也可分裂。
	- **合并** 是分裂操作的逆过程。
		- 注意，对于联系的合并，其类型必须是 **定义在相同的实体类型组合** 中，否则是不合法的合并。
6. 弱实体与弱联系

![E-R 模型的操作](http://oxnec2zdn.bkt.clouddn.com/DatabaseSQLServer/E-ROperation.png)

### 全局 E-R 模型的设计

1. 确定公共实体类型
	- 根据实体类型名和键来认定公共实体类型。
	- 把 **同名实体类型** 作为公共实体类型的一类候选。
	- 把 **具有相同键的实体类型** 作为公共实体类型候选。
2. 局部 E-R 模型的合并
	- 首先进行两两合并，先合并那些现实世界中有联系的局部结构，合并从公共实体类型开始，最后再加入独立的局部结构。
3. 消除冲突
	- 局部ER模型之间的不一致的地方，称之为 **冲突**。
	- 属性冲突
		- 属性域的冲突，即属性值的类型、取值范围或取值集合不同。
	- 结构冲突
		- 同一对象在不同应用中的不同抽象。
	- 命名冲突
		- 包括属性名、实体名、联系名之间的冲突。
	- 对于同一对象在不同的局部 E-R 模型中产生不同的抽象，其解决方式是：**把属性变为实体或把实体变为属性，使同一对象具有相同的抽象**。
	- 对于同一个实体在不同 E-R 模型中属性组成不同，其解决方式为：**取两个分 E-R 模型属性的并，作为合并后的该实体属性**。
	- 对于实体间的相同联系呈现的不同的类型，其解决方式为：**根据具体应用的语义，对实体键的联系作适当的综合或调整**。   
4. 全局模式的优化
	- 一个好的全局 E-R 模型，除能准确、全面地反映用户功能需求外，还应满足下列条件：
		- 实体类型的个数尽可能少。
		- 实体类型所含属性个数尽可能少。
		- 实体类型间无冗余联系。
	- 相关实体类型的合并
		- 一般在权衡利弊后可以把 1:1 联系的两个实体类型合并。
		- 具有相同键的实体类型常常是从不同角度刻画现实世界，如果经常需要同时处理这些实体类型，那么也有必要合并成一个实体类型。
	- 冗余属性的消除
		- 一般同一非键的属性出现在几个实体类型中，或者一个属性值可从其他属性值导出，此时，应把这些冗余的属性从全局模式中去掉。
		- 有时为了兼顾访问效率，有意保留冗余属性。
	- 冗余联系的消除
5. 最终全局 E-R 模型
	- 全局概念结构内部必须具有一致性，不再存在各种冲突；
	- 全局概念结构能准确地反映原各局部视图结构，包括属性、实体及实体间的联系；
	- 全局概念结构能满足需求分析阶段所确定的所有需求。    
	- 全局概念结构最终还应该提交给用户，征求用户和有关人员的意见，进行评审、修改和调整，最后确定的全局概念结构为数据库的逻辑设计提供依据。

## 逻辑结构设计

逻辑设计的目的是把概念结构设计阶段设计好的全局ER模型转换成与选用的具体机器上的DBMS所支持的数据模式相符合的逻辑结构（包括数据库模式和外模式）。

### E-R 模型向关系模式的转换

#### 实体类型

将每个实体里类型转换成一个关系模式，实体的属性即为关系的属性，实体标识符即为关系模式的键。

#### 二元联系类型

联系类型的转换联系类型转换成关系模式是根据不同的情况做不同的处理。下面以两个实体的联系为例做如下说明：  

- 若实体间的联系是 **1:1** 的，可以在两个实体类型转换成的两个关系模式中的 **任意一个关系模式的属性** 中加入 **另一个关系模式的键和联系类型的属性**。
- 若实体间的联系是 **1:N** 的，则在 **N 端实体类型** 转换成的关系模式中加入 **1 端实体类型转换成的关系模式的键和联系类型的属性**。
- 弱实体：若实体间的联系是 1:N 的，而且在 N 端实体类型为弱实体，转换成的关系模式中将 1 端实体类型（父表）的键作为外键放在 N 端的弱实体（子表）中，弱实体的主键由父表的主键与弱实体本身的候选键组成，也可以为弱实体建立新的独立的标识符 ID。
- 若实体间的联系是 **M:N** 的，则将联系类型也转换成关系模式，其 **属性为两端实体类型的键加上联系类型的属性**，而 **键为两端实体键的组合**。

> 加 **下划线** 者为 **主键**，红线者为 **外键**，通常是加 **波浪线**。

#### 三元和一元联系类型

- 若实体间的联系是 1:1:1，可以在三个实体类型转换成的三个关系模式中任意一个关系模式的属性中加另两个关系模式的键和联系类型的属性。
- 若实体间的联系是 1:1:N，则在 N 端实体类型转换成的关系模式中加入 1 端实体类型的键和联系类型的属性。
- 若实体间的联系是 1:M:N，则将联系类型也转换成关系模式，其属性为 1 端、M 端和 N 端实体类型的键加上联系类型的属性，而键是包含 M 端和 N 端实体键的组合。
- 若实体间的联系是 M:N:P，则将联系类型也转换成关系模式，其属性为三端实体类型的键加上联系类型的属性，而键是包含三端实体键的组合。

一元联系类型转换为关系模式时，只要分清楚两部分实体在联系中的身份，其余情况与一般二元联系相同。

### 关系模式的优化

在关系数据库的逻辑设计中，先是利用ER模型向关系模式转换规则初步得到一组关系模式集后，还应该再适当地修改、调整关系模式的结构，以进一步提高数据库应用系统的性能，这个过程称为 **关系模式的优化**。

- 确定函数依赖。
- 可用实体候选键之间的函数依赖来表示不同实体间的一对一、一对多、多对多的联系，然后对函数依赖进行最小化处理，消除冗余的联系。  
- 根据规范化理论对关系模式逐一进行分析，检查是否存在部分函数依赖、传递函数依赖等，确定各关系模式分别属于第几范式。
- 根据需求分析阶段得到的各种应用及对数据处理的要求，分析所在的应用环境中这些关系模式是否合适，确定是否要对它们进行合并或分解。
- 对关系模式进行必要的分解，以提高数据操作的效率和存储空间的利用率。
	- 水平分解：所谓水平分解是指把一个关系模式 R 中的元组分为若干子集合，定义每个子集合为一个子关系，以提高系统的效率。
	- 垂直分解：所谓垂直分解是把一个关系模式 R 的属性分解为若干子集合，形成若干子关系模式。    
		- 垂直分解的原则：凡是经常在一起使用的属性从 R 中分解出来形成一个子关系模式，这样也可以提高数据操作的效率。    
		- 垂直分解的方法可以采用简单的直观分解，也可以用关系模式分解算法进行分解。

关于关系模式的规范化问题，做如下两点说明：

- 并不是规范化程度越高的关系就越好。当一个应用的查询中经常涉及到两个或多个关系模式的属性时，系统必须经常地进行连接运算，而连接运算的代价是相当高的，可以说关系模式操作低效的主要原因就是做连接运算引起的。在这种情况下，第二范式甚至第一范式也许是最好的。
- 如果一个关系模式在实际应用中只是提供查询，并不提供更新操作，或者很少提供更新操作，此时不会存在更新异常问题或更新异常不是主要问题，可以不对关系模式进行分解。

## 物理结构设计

数据库的物理结构主要指数据库的存储记录格式、存储记录安排和存取方法。

1. 确定存储结构
2. 选择存取方法
	- 存取方法有索引、聚簇等方法。

数据库物理结构设计实际完成后，还应该进行评价，以确定物理设计结构是否满足设计要求。
评价的内容主要集中在时间和空间的效率方面。

## 数据库的实施

- 建立实际数据库结构。
- 装入试验数据对应用程序进行调试。
- 装入实际数据，进入试运行状态。

## 数据库运行和维护

- 维护数据库的安全性与完整性。
- 监测并改善数据库运行性能。
- 根据用户要求对数据库现有功能进行扩充。
- 及时改正运行中发现的系统错误。
