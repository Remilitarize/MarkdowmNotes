[toc]

动态模型用来描述系统的动态行为，分为 **状态模型** 和 **交互模型**。

- 用 **顺序图** 和 **合作图** 为交互模型建模。
- 用 **状态图** 和 **活动图** 为状态模型建模。

## 系统设计

系统设计的一般步骤包括：

- 系统对象设计
- 系统体系结构设计
- 系统设计的优化和审查

### 系统对象设计

对象设计是为每个类的属性和操作做出详细的设计，并设计连接类及其相关联类间的消息规约。

主要活动有：

- 对象接口设计
- 设计算法和数据结构
- 确认子系统
- 子系统间的通信规约

### 系统体系结构设计

系统体系结构设计是对系统软、硬件资源做统一规划。

- 任务管理设计
    - 通过分析对象动态模型，可以发现系统是否具有并发性，从而决定系统采用主从结构设计还是分布式结构设计。
    - **主从结构设计**
        - 如果对象（或子系统）不是同时活动的，则它们不需要并发处理。
        - 此时这些对象（或子系统）可以在同一个计算机上实现。
    - **分布式结构设计**
        - 如果对象（或子系统）必须对一些时间同时异步地动作，则它们被视为是 **并发的**。
        - 此时，可以将并发的子系统分别分配到不同的计算机，或者分配在同一计算机，并由操作系统提供并发支持。
- 数据管理设计
    - 定义数据类型。
    - 设计数据管理。
    - 具体包括：文件管理、关系数据库管理、面向对象数据库管理、数据存储的结构设计以及设计相应的操作。
- 用户界面设计。
    - 主要有：用户分类、描述用户及其任务的场景、设计命令层、设计详细的交互、设计人机交互类、根据图形用户界面进行设计等。

### 系统设计的优化和审查

把一个复杂系统划分为几个子系统，每个子系统还可以划分为更小的子系统。

- 最小的子系统就是 **构件**。
- 构件具有复用性。

### 系统设计规格说明报告

![系统设计规格说明报告](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/xitongshejiguigeshuomingbaogao.png)

## 交互模型建模

在面向对象的分析与设计中，顺序图和合作图主要用于对 **用例图中控制流** 的建模，用它们来描述用例图的行为。

### 对象之间的通信

当一个对象调用另一个对象的操作时，**消息** 通常是通过简单的 **操作调用** 来实现的。

- 一条消息被画成从消息的发送者指向接收者的一个箭头线，线上标有消息内容标识。
- 消息一旦发送，系统控制权便从发送者转移到接收者。
- 当一个操作被执行后，控制权将返回给消息发送者，并携带一个回送值。

消息内容标识的格式：

```
[序号] [警戒条件] * [重复次数] [回送值表: = ] 操作名(参数表)
```

> 方括号表示可缺省。

- [序号]：表示消息在对象间交互的时间顺序号。
    - 一般用正整数 1、2、3… 表示。
    - 嵌套消息用十进制数 1.1、1.2、2.1、2.2… 表示。
    - **序号在合作图中必不可少，序号在顺序图中可缺省。**
- [警戒条件]：为一布尔条件表达式。
    - 满足警戒条件时才能发送消息。
    - 缺省时，表示消息无条件发送。
- \* [重复次数]：表示消息重复发送的次数。
    - 只有 \* 号，无 [重复次数]，表示消息多次发送，次数未定。
    - 缺省时，表示只发送一次。
- [回送值表: = ]：以 `,` 区分的名字列表，分别表示完成指定操作后返回的系列值。
- 操作名：必须是接受该消息的对象类角色中的操作名。
- ()：括号内列出参数表，以 `,` 区分不同的参数。
    - 传送给接受消息的对象中的某个操作时，参数的个数、次序、类型必须与该操作的参数一致。

### 同步通信与异步通信

在 UML 中，消息的分类可以从两个角度区分：

- 从消息 *触发的动作* 区分：
    - 创建一个对象或释放一个对象
    - 调用另一个对象的操作
    - 调用本对象的操作
    - 发送信息给另一个对象
    - 返回值给调用者
- 从消息的 *过程控制流*  进行区分
    - **简单消息**
        - 表示控制流，用 **带叉形箭头的实线箭头** 表示。
        - 当通信细节不知道或在图中涉及不到时使用这种消息类型。
    - **同步消息**
        - 表示嵌套的控制流，用 **带实心三角形箭头的实线箭头** 表示。
        - 这种消息的处理一般在被调用的操作执行后，调用者再继续执行。
        - 当消息被处理完后，可以回送一个就简单消息，或者是隐含的返回。
    - **异步消息**
        - 表示异步控制流，用 **带半叉箭头的实线箭头** 表示。
        - 消息的发送者在发送消息后就继续执行，而不等待消息的处理。
        - 通常用于对象并发执行的实时系统。
    - **返回消息**
        - 表示控制流的返回，用 **带叉形箭头的虚线箭头** 表示。
        - 一般可以缺省，隐含表示每一个调用都有一个配对的调用返回。
        - 缺省时，返回值可以标在初始调用的箭头上。
        - 对于非过程控制流，包括并行处理和异步消息，表示返回的虚线箭头不可省略。

![同步消息与异步消息](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/tongbuxiaoxiyuyibuxiaoxi.png)

## 顺序图建模

**顺序图** 用来描述对象间的交互行为。
注重消息的 **时间顺序**。

![顺序图](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/shunxutu.png)

### 顺序图的组成成分

顺序图有两个坐标:

- 垂直坐标表示时间顺序（从上到下）
- 水平坐标表示一组对象。

顺序图的组成成分包括：

- **对象**
    - 用短式对象框表示。
    - 交互频繁的对象应尽量靠拢。
    - 对整个交互活动进行初始化的对象放在图的最左边。
    - 在交互过程中产生的对象框应放在产生该对象的时间点处。
    - 过程中对象改变了属性值、状态或角色，则在生命线上该对象的改变点处画上该对象的图符副本，并注明有关的变更。
- **生存线**
    - 对象框下画一条 **垂直虚线** 称为该对象的生存线，表示该对象的生存时间。
    - 生存线从该对象创建开始到释放，其生存期多长，虚线就有多长。
- **消息**
    - 对象之间消息的发送和接受用两个对象生存线（激活期）之间的消息箭头线表示。
    - **传送延迟** 可用 **倾斜的箭头** 表示，意思是消息发送后需经历一段延迟时间才被接收（可注明最大延迟时间）。
- **对象激活期**
    - 对象生存线上一个 **细长长方框**，表示该对象的激活时间段。
    - 当一个休眠的对象接收到一个消息时，该对象开始活动，称为 **激活**。
    - 激活期长方框的上端与动作的开始时间齐平，下端与动作的完成时间齐平。
    - 激活期外，对象处在 **休眠期**。

### 对象之间的同步与异步操作

#### 对象之间的同步操作

**同步消息** 是通过操作调用完成同步操作的嵌套控制流。

操作过程如下：

- 同步消息的发送者把进程控制传递给消息的接收者，然后暂停活动，等待消息的接收者放弃或返回控制。
- 同步消息的接收者执行所请求的操作，如果需要的话，可以把控制传递给另一个对象角色，请求做某个操作，并且当该操作完成后把控制返回给原来的同步消息的发送者。
- 同步消息的接收者也可以直接返回或发送信息给原来的消息发送者。

> 如果设计人员不想在箭头上方标明具体调用某个函数，可以用 `<< >>` 围起的一段文字描述传递消息的内容，也可以不用 `<< >>` 围起。

同步消息传递中，有三种不同的返回消息描述：

- 一条带叉形箭头的虚线箭头。
- 一条左边带叉形箭头而右边为带实心三角形箭头的箭头。
- 采用隐含方式描述，不画出代表返回消息的箭头。

#### 对象之间的异步操作

**异步消息** 是表达异步请求一个操作的非嵌套的控制流。

操作过程如下：

- 异步消息的发送者通过发送消息把信号传递给消息的接收者，然后继续自己的活动，不等待消息接收者返回信息或控制。
- 异步消息的接收者执行所请求的操作，操作完成后可以向异步消息的发送者返回信息。
- 异步消息的发送者和接收者采用并发工作方式。

在顺序图中存在大量的异步消息，一条异步消息每次只能发一个信号，即只能做一件事。
可以做的事情有：

- 创建一个新对象。
- 创建一个新线程，此时异步消息连接到一个激活期的顶部。
- 与一个正在运行的线程通信。

顺序图有两种描述形式：

- 一般形式
    - 一般形式用来描述一个场景中所有可能的选择。
    - 因此它可以包含条件、约束、分支和循环等操作。
- 实例形式
    - 实例形式详细描述一个特定的场景，说明一次可能的交互。
    - 因此实例形式的顺序图中没有任何条件、分支和循环。

### 顺序图中的分支控制

当几个消息箭头上的条件互斥时，表示某一时刻只有一个消息被发送，称为 **条件分支**。
条件分支使用 **警戒条件** 表示。

![分支控制](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/fenzhikongzhi.png)

### 顺序图中的约束标记

约束眼红分隔符 `{}` 围起。
标记可以是任意类型的，如时间标记和时间约束。

![约束标记](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/yueshubiaoji.png)

### 顺序图中的循环处理操作

一个对象向另一个对象连续多次发送一系列消息，称为 **消息的循环处理**。

- 在 UML 的顺序图中，循环处理标识用一个 **矩形框** 与其包含的一组消息表示。
- 表示停止（或继续）循环的条件用 **方括号** 围起并表示在矩形框内的底线上。

![矩形框循环](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/junxingkuangxunhuan.png)

还可以用一条在发送方竖立的 **虚线** 代替矩形框，循环条件标记在虚线的下端。

![虚线循环](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/xuxianxunhuan.png)

### 对象的创建和消亡

- 在 UML 的顺序图中，一个对象可以通过一条消息创建另一个对象，被创建的对象可在创建它的消息箭头所指地方（垂直时间轴下）画一个对象符号。
- 当对象消亡时，在图中该对象图符位置上用一个 **&times; 符号** 表示。

## 合作图建模

**合作图** 和顺序图都可以用来描述系统对象之间的交互。

- 顺序图强调一组对象之间操作调用的时间顺序。
- 合作图则强调这组对象之间的 **关系**。

### 合作图的组成部分

组成一个合作图的图形元素包括：

- **对象**
    - 使用短式标记。
    - 如果不标明角色名，则说明该对象角色为匿名对象。
- **链接**
    - 对象之间的链接用连接两个对象的 **实线** 表示。
    - 链接线上可以标明角色名，**链接角色名** 用来说明链接路径，规定在交互中对象之间链接的角色类型。
    - 对象之间用实线连接，表示它们之间有 **关联**，**关联角色** 和 **多重性** 标志在关联的两段标出。
    - 在链接的两段还可以标明约束，种类有：
        - **全局性（global）**：表明该角色是全局的。
        - **局部性（local）**：表明该角色是一个操作中的局部变量。
        - **参数性（parameter）**：表明该角色是一个操作中的参数。
        - **自我性（self）**：指明对象可以向自身发送消息。
        - **表决性（vote）**：用于约束回送消息。
        - **广播性（broadcast）**：用于一组消息的约束，指出这组消息没有明确的目标对象。
- **消息**
    - **消息箭头** 表示对象之间的消息流。
    - 消息上标以 **序号**，表示消息发送的顺序。
    - 还可以指明条件、重复和回送值等。

![具有约束的合作图](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/juyouyueshudehezuotu.png)

消息的种类有：

- **嵌套消息**
    - 用 **整数** 指定消息发送的顺序号。
    - 消息 1.1 是消息 1 处理中的第 1 个 **嵌套消息**。
    - 如果是同步消息，则嵌套地调用操作并等待返回。
- **并发消息**
    - **相同的顺序号** 后面的 **不同字母** 表示并行的控制线程，例如 1.2a 和 1.2b。
- **循环发送消息**
    - 表示有条件地重复执行。
    - 形式：`*[循环执行条件]`
- **条件发送消息**
    - 表示当满足条件时发送该消息。
    - 形式：`[执行条件]`

### 合作图中对象的创建与消亡

在合作图的对象框中，可以在花括号 `{}` 内填写文字用来表示该对象的创建或消亡。

- **对象创建：`{new}`**，表示该对象在协作期被创建。
- **对象消亡：`{destroy}`**，表示该对象在协作期消亡。
- **对象创建并消亡：`{transient}`**，表示该对象在协作期被创建并消亡。

### 嵌套消息与顺序消息的标识

采用消息嵌套表示方法描述对象之间消息传递的先后顺序，各个消息之间的层次隶属关系一目了然。

> 在循环处理过程中所有对象发出的消息都是嵌套消息。

使用顺序排列各个消息，对象间的消息根据序号依次传递，作用上虽然可以达到嵌套消息的效果，但没有层次感。

### 异步操作中的回调消息

#### 自调用

在合作图中，一个对象可以调用自己的操作，即消息的 **自我调用**（也称作 **递归调用**）。

- 表示方法：**链接线从消息的发送者对象返回到对象本身**，可以在链接线旁标记构造型 `<<self>>`。

#### 异步操作中的回调

在合作图中的对象之间也有消息的回调，即消息的接收对象也可以向消息的发送对象发送消息，称为 **回调**。

- 消息回调的标记是在对象链接线的 **上下方各有一条方向相反的消息**。
- 如果链接线上方的消息为正常消息传递方向，则其下方的反方向传送消息就称为回调。
- 回调都是异步消息，可以并发运行。

> `self` 参数是保留字，表示给消息的接收方发送对象发送方自身的句柄。

### 循环发送同一个重复消息

表示方法：`*[循环条件]: 操作名()`

![带循环发送的合作图](http://oxnec2zdn.bkt.clouddn.com/UMLxitongjianmo/daixunhuanfasongdehezuotu.png)

## 动态交互模型——控制流建模

- **进程**：进程是一个动作流，能够与其他进行并发执行。
- **线程**：线程是进程内部的一个动作流，能够与其他线程并发执行。
- **主动对象**：一个拥有进行或线程的对象，能初始化控制活动。
    - 主动对象一旦被创建，无需其他对象发来消息触发即能自动执行动作。
    - 一个系统中可以有多个主动对象，各自独立并发执行。
- **被动对象**：必须由其他对象发来的消息进行触发才执行动作的对象。
- **主动对象类**：主动对象类是主动对象的抽象。主动对象是主动对象类的实例。
    - 主动对象用约束 `{active}` 来说明或用 **粗线条** 的对象框表示。
