[toc]

- 微处理器的一般结构
	- 内部结构
	- 外部结构

## 微处理器的外部结构

![微处理器的外部结构](http://oxnec2zdn.bkt.clouddn.com/microcomputer/ExternalStructure.png)

- 按功能分，总线可以分为三种
	- 传送信息（指令或数据）的 **数据总线（Data Bus）**
	- 指示欲传信息的来源或目的地址的 **地址总线（Address Bus）**
	- 管理总线上活动的 **控制总线（Control Bus）**

### 地址总线

CPU 通过地址总线输出地址码来选择某一存储单元或某一称为 I/O 端口的寄存器。

- **单向**
- 地址码的 **位数** 决定了 **地址空间的大小**。
	- n 位地址总线可有 2<sup>n</sup> 个地址。
	- 16 位地址总线：65536 B = 64 KB
	- 20 位地址总线：1 MB
	- 32 位地址总线：4 GB
- 8086/8088地址总线有 **20 位**。
	- I/O地址总线 16 位（低 16 位）

### 数据总线

用于 CPU 和存储器或 I/O 接口之间传送数据。

- **双向**
- 微处理器 **数据总线的条数** 决定 CPU 和存储器或 I/O 设备一次能交换数据的 **位数**，**是区分微处理器是多少位的依据**。
	- 8086 CPU 的数据总线是 16 条，我们就说 8086 CPU 是 16 位微处理器。

### 控制总线

- 管理总线上的活动，用来传送自 CPU 发出的控制信息或外设送到 CPU 的状态信息。
- 大部分是单向的，有一些是双向的。

## 微处理器的内部结构

- 具备功能
	- 进行算术和逻辑运算。
	- 具有接收存储器和 I/O 接口来的数据和发送数据给存储器和 I/O 接口的能力。
	- 可以暂存少量数据。
	- 能对指令进行寄存、译码并执行指令所规定的操作。
	- 能提供整个系统所需的定时和控制信号。
	- 可响应 I/O 设备发出的中断请求。

![微处理器的内部结构](http://oxnec2zdn.bkt.clouddn.com/microcomputer/InternalStructure.png)

- **算术逻辑运算单元（ALU）**
	- 它是运算器的核心，几乎所有的算术运算，逻辑运算和移位操作都是由 ALU 完成的。
- **工作寄存器**
	- 地址寄存器
		- 操作数的寻址。
	- 数据寄存器
		- 暂存操作数和中间运算结果。
- **控制器**
	- 它是CPU的“指挥中心”，完成指令的读入，寄存，译码和执行。
- **I/O 控制逻辑**
	- 处理输入/输出操作。
- 控制器由六部分构成
	- **程序计数器（PC）**
		- 保存 **下一条** 要执行的指令的 **地址**。
	- **指令寄存器（IR）**
		- 保存从存储器中读入的 **当前要执行的指令**。
	- **指令译码器（ID）**
		- 对指令寄存器中保存的指令进行译码分析。
	- **控制逻辑部件**
		- 根据 ID 对指令的译码分析，发出相应的一系列的节拍脉冲和电位（控制信号），去完成指令的所有操作。
	- **处理机状态字（PSW）**
		- 暂存处理器当前的状态。
		- PSW 中的各位用来指示诸如算术运算结果的正/负，是否为零，是否有进位或借位，是否溢出等标志。
		- 条件转移指令将根据 PSW 中的某一位的状态决定程序是否转移。
	- **堆栈指示器（SP）**
		- 在对按后进先出原则组织的称为堆栈的专用存储区进行操作时提供地址的。

## 微处理器的功能结构

- 8086/8088 特点
	- 具有 20 条地址线，直接寻址能力达1MB。
	- 8086 有 16 条数据线，为 **16 位微处理器**。
	- 8088 有 8 条数据线，为 **准 16 位微处理器**。
	- 片内总线和 ALU 均为 16 位，可进行 8 位和 16 位操作。
- 主要包含两个 **独立的逻辑单元**
	- 执行单元（EU）
	- 总线接口单元（BIU）

![微处理器的功能结构](http://oxnec2zdn.bkt.clouddn.com/microcomputer/FunctionStruction.png)

### 总线接口单元

- 其中包含
	- **段寄存器（CS，DS，ES，SS）**
	- **指令指针寄存器（IP）**
	- **指令队列寄存器**
		- 8086 CPU：6字节
		- 8088 CPU：4字节
	- **地址形成逻辑**
	- **总线控制逻辑**
- 功能
	- 主要负责从存贮器指定区域取出指令并将取出的指令送到 **指令队列寄存器** 中排队。
- BIU 何时会停止取指令
	- EU 执行的指令需要和外部存贮器或者 I/O 端口之间进行数据传送时
	- 指令队列满时

### 执行单元

- 其中包含
	- 通用寄存器（8个）
	- 标志寄存器（FLAG）(即 PSW)
	- 算术/逻辑运算单元（ALU）
	- EU 控制器
- 功能
	- 从 **指令队列寄存器** 中获取指令，并对指令加以执行，完成指令所规定的操作。
	- 同时也负责算术/逻辑运算以及进行内存有效地址的计算等。

## 微处理器的寄存器组织

### 通用寄存器

- 数据寄存器
- 地址指针和变址寄存器

#### 数据寄存器

- **累加器 AX**
- **基址寄存器 BX**
	- 经常用作地址寄存器
- **计数寄存器 CX**
	- 用作循环的计数寄存器
- **数据寄存器 DX**
	- 用于寄存数据。
	- 在 I/O 指令中，用于表示端口地址。

> 数据寄存器都是 **16** 位的。

- 每个数据寄存器又可以分成两个 **8** 位寄存器
	- **AX &rarr; AH, AL**
	- **BX &rarr; BH, BL**
	- **CX &rarr; CH, CL**
	- **DX &rarr; DH, DL**
	- 其中 `H` 表示 **高 8 位**，`L` 表示 **低 8 位**.

#### 地址指针/变址寄存器

- **堆栈指针寄存器 SP**
	- 用于保存堆栈段的段内偏移地址。
- **基址指针寄存器 BP**
	- 指定段内的偏移地址。
- **源变址寄存器 SI**
	- 提供 **源操作数** 的段内偏移地址。
	- 在其他指令中，用作地址寄存器。
- **目的变址寄存器 DI**
	- 提供 **目的操作数** 的段内偏移地址。
	- 在其他指令中，用作地址寄存器。

> 地址指针/变址寄存器均为 **16** 位寄存器，同时也可以存放数据。

#### 物理地址的计算方法

**物理地址 = 段地址 * 10H + 偏移地址**

### 段寄存器

- **代码段寄存器 CS**
	- 用于存放 **当前执行程序** 的段地址。
- **数据段寄存器 DS**
	- 用于存放 **当前数据段** 的段地址。
- **附加段寄存器 ES**
	- 用于存放 **当前附加数据段** 的段地址。
- **堆栈段寄存器 SS**
	- 用于存放 **当前堆栈段** 的段地址。

> 段寄存器均为 **16** 位。

### 控制寄存器

- **指令指针寄存器 IP**
	- **16** 位。
	- 也称 **程序计数器 PC**
	- 保存 **下一条** 要执行指令的段内偏移地址。
	- **不能直接修改 IP 值。**
	- 可以通过转移指令、子程序调用和返回指令修改 IP 内容。
- **标志寄存器 FLAG**
	- **16** 位。
	- 但只有 **9** 位有用。
	- 分为 **6** 个状态标志，**3** 个控制标志。
- 状态标志

|标志位|符号|寄存器中的位置|描述|
|-|-|-|-|
|进位标志|CF|0|加法最高位产生 **进位** 或减法最高位产生 **借位** 时为 1，否则为 0|
|辅助进位标志|AF|4|在加减运算时，**D3 位有无进（借）位**，有则为 1，无则为 0|
|奇偶标志|PF|2|操作结果的低 8 位中 **含有"1"的个数**,偶数为 1，奇数为 0|
|零标志位|ZF|6|**运算结果为 0** 时为 1，否则为 0|
|符号标志|SP|7|**操作结果的符号**，等同于操作的最高位|
|移除标志|OF|11|有符号数运算时 **溢出**为 1，否则为 0|

- 补充：
	- 将字段或字从低位至高位依次从 **D0** 标号，字段的最高位为 **D7**，字的最高位为 **D15**。

- 控制标志

|标志位|符号|寄存器中的位置|描述|
|-|-|-|-|
|方向标志|DF|10|在字符串操作中，为 0 时 SI/DI 的内容自动递增，为 1 时递减|
|中断允许标志|IF|9|当为 1 时 CPU 能够响应可屏蔽中断请求，为 0 则不能|
|陷阱标志|TF|8|当为 1 时，CPU 处于单步执行方式|

- 补充：
	- 使用 `STD` 指令将 DF 置 1，使用 `CLD` 指令将 DF 置 0。
	- 使用 `STI` 指令将 IF 置 1，使用 `CLI` 指令将 IF 置 0。
	- IF 对 **外部非可屏蔽中断请求** 以及 **CPU 内部的中断** 不起作用。

## 微处理器的存储器和I/O组织

> **物理地址** 由 **段地址** 和 **段内偏移地址** 两部分组成。

- 8086 有 **20** 条地址总线，可以表示 **20** 位物理地址。
- 由于段寄存器为 **16** 为寄存器，可以提供 **16** 位段地址。
- 由于基址或变址寄存器为 **16** 位寄存器，可以提供 **16** 位偏移地址。
- 物理地址的计算方法
	- **物理地址 = 段地址 * 10H + 偏移地址**

> 例：
> 00054H 可以表示成

> - 0000H + 0054H
- 0001H + 0044H
- 0002H + 0034H
- 0003H + 0024H
- 0004H + 0014H
- 0005H + 0004H
