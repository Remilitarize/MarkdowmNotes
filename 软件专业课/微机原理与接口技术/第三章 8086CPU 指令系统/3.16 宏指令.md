[toc]

宏指令是用户自己定义的指令，它是由指令和伪指令构成的一个程序段。

## 宏指令的定义

```
<宏指令名> MACRO [<形式参数>]
... ; 指令或伪指令构成的宏体
ENDM
```

## 宏调用与宏展开

- 宏调用语法：`宏指令名 <实际参数>`
	- 实际参数应该与宏指令定义时的形式参数一一对应。
在汇编过程中，当汇编到宏调用语句时，将用宏体中的一段程序来代替这一条宏指令，并且用实际参数取代形式参数。

## 宏指令中的标号与变量

当宏指令定义中出现标号或变量定义语句时，由于多次调用会出现相同的标号或变量的定义，从而导致汇编出错。
这时应该采用伪指令 **LOCAL** 将宏指令中的标号或变量指定为 **局部标号或变量**。

- 局部标号或变量的定义语法
	- `LOCAL 标号或变量`

## 重复宏

重复宏指示汇编程序对指定的一组语句进行重复汇编。
重复宏不一定出现在宏定义中，可以在程序的任意位置，但一旦出现在宏定义中，则必须先结束重复宏，然后再结束宏定义。

### 重复宏 REPT

```
REPT <表达式>
... ; 由指令和伪指令构成的重复内容
ENDM
```

根据给定的表达式计算出重复的次数，从而重复指定的程序段。
当表达式的值不是整数时，进行取整运算。

### 不定重复宏 IRP

```
IRP <形式参数>, <<参数1>, <参数2>, ...>
... ; 由指令和伪指令构成的重复内容
ENDM
```

表示将尖括号内的各个参数依次赋给形式参数，并重复指定的程序段。

### 不定字符重复宏 IRPC

```
IRPC <形式参数>, <字符串>
... ; 由指令和伪指令构成的重复内容
ENDM
```

表示将字符串中的各个字符依次赋给形式参数，并重复执行指定的程序段。

## 宏指令与子程序的比较

|&nbsp;|优点|缺点|
|-|-|-|
|宏指令|执行速度快、设计灵活、修改方便|占用内存多|
|子程序|占用内存少|执行速度慢、设计不太灵活|
