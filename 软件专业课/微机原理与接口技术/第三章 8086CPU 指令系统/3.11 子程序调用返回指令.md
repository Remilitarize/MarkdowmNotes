[toc]

子程序调用是通过自动修改（IP）和/或（CS）的内容实现的。
为了确保子程序调用后能够返回到调用指令之后，CALL 指令会自动保存返回地址（IP 和/或 CS），而 RET 指令会自动返回到 CALL 指令的下一条指令。

## 子程序调用指令 CALL

```
CALL LABEL; 调用入口地址为标号 LABEL 的子程序
CALL OPR; 调用子程序，其入口地址为操作数 OPR 的内容
```

- 第一种格式
	- 标号 LABEL 与 CALL 指令不在同一个段内
		- CS 入栈，IP 入栈，(IP) &larr; LABEL 的偏移地址，(CS) &larr; LABEL 的段地址。
		- 寻址方式为 **段间直接寻址**。
	- 标号 LABEL 与 CALL 指令在同一个段内，且可以采用 8 位有符号数表示其相对偏移量。
		- IP 入栈，(IP) &larr; (IP) + DISP8
		- 寻址方式为 **段内直接寻址**。
	- 标号 LABEL 与 CALL 指令在同一个段内，且需要采用 16 位有符号书表示相对位移量时。
		- IP 入栈，(IP) &larr; (IP) + DISP16
		- 寻址方式为 **段内直接寻址**，也成相对寻址。
- 第二种格式
	- 当 OPR 为 16 位的通用寄存器 REG16 时：
		- 子程序的调用在段内进行.
		- IP 入栈，(IP) &larr; (REG16)
		- 寻址方式为 **段内间接寻址**.
	- 当 OPR 为 16 为的存储单元 RAM 时：
		- 子程序的调用在段内进行。
		- IP 入栈，(IP) &larr; (RAM)
		- 寻址方式为 **段内间接寻址**。
	- 当 OPR 为 32 位的存储单元 RAM 时：
		- 子程序的调用在段间进行
		- IP 入栈，CS 入栈，(IP) &LARR; (RAM)，(CS) &larr; (RAM + 2)
		- 寻址方式为 **段间间接寻址**。

## 子程序返回指令 RET

```
RET ; 用于段内子程序的返回，完成 IP 出战
RETF ; 用于段间子程序的返回，完成 IP 出栈，CS 出栈
RET n; 完成 RET（或RETF）指令功能后，(SP) ← (SP) + n
```

## 过程定义

```
过程名 PROC [类型]
...
RET
过程名 ENDP
```

- 子程序的类型可以取 `NEAR` `FAR`。当缺省时，表示 `NEAR`。
